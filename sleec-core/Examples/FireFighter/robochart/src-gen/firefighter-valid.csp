
--Specify the integer intervals for type Int e.g. {0..30}. 

channel CameraStart
channel personNearby, i_personNearby : Bool
Mem_personNearby(o__) =
	let
		Mem =  personNearby?x__ -> (Provide(x__) /\ tock -> Mem)
		Provide(x__) = RUN(union({|i_personNearby.x__|},o__))
	within
		Mem
channel GoHome
channel temperature, i_temperature : core_int
Mem_temperature(o__) =
	let
		Mem =  temperature?x__ -> (Provide(x__) /\ tock -> Mem)
		Provide(x__) = RUN(union({|i_temperature.x__|},o__))
	within
		Mem
channel BatteryCritical
channel SprayWater
channel detectPersonFallen, i_detectPersonFallen : Bool
Mem_detectPersonFallen(o__) =
	let
		Mem =  detectPersonFallen?x__ -> (Provide(x__) /\ tock -> Mem)
		Provide(x__) = RUN(union({|i_detectPersonFallen.x__|},o__))
	within
		Mem
channel SeekHelp
channel humanDetected, i_humanDetected : Bool
Mem_humanDetected(o__) =
	let
		Mem =  humanDetected?x__ -> (Provide(x__) /\ tock -> Mem)
		Provide(x__) = RUN(union({|i_humanDetected.x__|},o__))
	within
		Mem
channel animalDetected, i_animalDetected : Bool
Mem_animalDetected(o__) =
	let
		Mem =  animalDetected?x__ -> (Provide(x__) /\ tock -> Mem)
		Provide(x__) = RUN(union({|i_animalDetected.x__|},o__))
	within
		Mem
channel RemainAnonymous
channel ReportLocation
MAX_TEMPERATURE = 30
channel FullyCharged
channel TestEfficiencyPreserved
channel StartMission
channel FinishMission
MAX_MISSION_TIME = 60
channel NotifyError
channel authorized, i_authorized : Bool
Mem_authorized(o__) =
	let
		Mem =  authorized?x__ -> (Provide(x__) /\ tock -> Mem)
		Provide(x__) = RUN(union({|i_authorized.x__|},o__))
	within
		Mem
channel OperatorInstruction
channel SoundWarningMessage
channel distance, i_distance : core_int
Mem_distance(o__) =
	let
		Mem =  distance?x__ -> (Provide(x__) /\ tock -> Mem)
		Provide(x__) = RUN(union({|i_distance.x__|},o__))
	within
		Mem
channel SoundAlarm
channel batteryFull, i_batteryFull : Bool
Mem_batteryFull(o__) =
	let
		Mem =  batteryFull?x__ -> (Provide(x__) /\ tock -> Mem)
		Provide(x__) = RUN(union({|i_batteryFull.x__|},o__))
	within
		Mem
channel BatteryAlarmandGoHome
	
Capabilities = 
  {| CameraStart,
     GoHome,
     BatteryCritical,
     SprayWater,
     SeekHelp,
     RemainAnonymous,
     ReportLocation,
     FullyCharged,
     TestEfficiencyPreserved,
     StartMission,
     FinishMission,
     NotifyError,
     OperatorInstruction,
     SoundWarningMessage,
     SoundAlarm,
     BatteryAlarmandGoHome,
  	 personNearby,
  	 temperature,
  	 detectPersonFallen,
  	 humanDetected,
  	 animalDetected,
  	 authorized,
  	 distance,
  	 batteryFull
  |}
Measures =
  {| personNearby,
     temperature,
     detectPersonFallen,
     humanDetected,
     animalDetected,
     authorized,
     distance,
     batteryFull
  |}
	

Timed(OneStep) {

-- FRule1 when SoundAlarm and (batteryFull) then not GoHome within 5 minutes 

FRule1 = TriggerFRule1; MonitoringFRule1; FRule1

TriggerFRule1 = let
	MTrigger = StartBy(batteryFull?vbatteryFull ->
		if (vbatteryFull) then SKIP else TriggerFRule1
	,0)
within SoundAlarm -> MTrigger 
	[] GoHome -> TriggerFRule1

MonitoringFRule1 = WAIT((5 * 60))

-- alphabet for FRule1 
AFRule1 = {|GoHome, SoundAlarm, batteryFull|}
SLEECFRule1 = timed_priority(FRule1)


-- FRule2 when SoundAlarm then CameraStart within 1 minutes 

FRule2 = TriggerFRule2; MonitoringFRule2; FRule2

TriggerFRule2 = SoundAlarm -> SKIP	[] CameraStart -> TriggerFRule2


MonitoringFRule2 = StartBy(CameraStart -> SKIP,(1 * 60))

-- alphabet for FRule2 
AFRule2 = {|CameraStart, SoundAlarm|}
SLEECFRule2 = timed_priority(FRule2)


-- FRule3 when BatteryCritical then BatteryAlarmandGoHome within 5 minutes 

FRule3 = TriggerFRule3; MonitoringFRule3; FRule3

TriggerFRule3 = BatteryCritical -> SKIP	[] BatteryAlarmandGoHome -> TriggerFRule3


MonitoringFRule3 = StartBy(BatteryAlarmandGoHome -> SKIP,(5 * 60))

-- alphabet for FRule3 
AFRule3 = {|BatteryCritical, BatteryAlarmandGoHome|}
SLEECFRule3 = timed_priority(FRule3)


-- FRule4 when StartMission and (detectPersonFallen) then SeekHelp within 5 seconds 

FRule4 = TriggerFRule4; MonitoringFRule4; FRule4

TriggerFRule4 = let
	MTrigger = StartBy(detectPersonFallen?vdetectPersonFallen ->
		if (vdetectPersonFallen) then SKIP else TriggerFRule4
	,0)
within StartMission -> MTrigger 
	[] SeekHelp -> TriggerFRule4

MonitoringFRule4 = StartBy(SeekHelp -> SKIP,(5 * 1))

-- alphabet for FRule4 
AFRule4 = {|detectPersonFallen, StartMission, SeekHelp|}
SLEECFRule4 = timed_priority(FRule4)


-- FRule5 when CameraStart and (humanDetected) then RemainAnonymous 

FRule5 = TriggerFRule5; MonitoringFRule5; FRule5

TriggerFRule5 = let
	MTrigger = StartBy(humanDetected?vhumanDetected ->
		if (vhumanDetected) then SKIP else TriggerFRule5
	,0)
within CameraStart -> MTrigger 
	[] RemainAnonymous -> TriggerFRule5

MonitoringFRule5 = RemainAnonymous -> SKIP

-- alphabet for FRule5 
AFRule5 = {|CameraStart, humanDetected, RemainAnonymous|}
SLEECFRule5 = timed_priority(FRule5)


-- FRule6 when CameraStart and ((animalDetected) or (humanDetected)) then ReportLocation 

FRule6 = TriggerFRule6; MonitoringFRule6; FRule6

TriggerFRule6 = let
	MTrigger = StartBy(animalDetected?vanimalDetected ->
		StartBy(humanDetected?vhumanDetected ->
			if ((vanimalDetected) or (vhumanDetected)) then SKIP else TriggerFRule6
		,0)
	,0)
within CameraStart -> MTrigger 
	[] ReportLocation -> TriggerFRule6

MonitoringFRule6 = ReportLocation -> SKIP

-- alphabet for FRule6 
AFRule6 = {|CameraStart, humanDetected, animalDetected, ReportLocation|}
SLEECFRule6 = timed_priority(FRule6)


-- FRule7 when BatteryCritical then GoHome 
-- unless ((personNearby) and ((temperature) > (MAX_TEMPERATURE))) then SoundAlarm

FRule7 = TriggerFRule7; MonitoringFRule7; FRule7

TriggerFRule7 = BatteryCritical -> SKIP	[] GoHome -> TriggerFRule7
	[] SoundAlarm -> TriggerFRule7


MonitoringFRule7 = let
	Monitoring1 = GoHome -> SKIP
	Monitoring2 = SoundAlarm -> SKIP
within StartBy(personNearby?vpersonNearby ->
	StartBy(temperature?vtemperature ->
		if ((vpersonNearby) and ((vtemperature) > (MAX_TEMPERATURE))) then Monitoring2
		else (Monitoring1)
	,0)
,0)

-- alphabet for FRule7 
AFRule7 = {|GoHome, personNearby, temperature, BatteryCritical, SoundAlarm|}
SLEECFRule7 = timed_priority(FRule7)


-- FRule8 when FullyCharged then TestEfficiencyPreserved within 24 hours 

FRule8 = TriggerFRule8; MonitoringFRule8; FRule8

TriggerFRule8 = FullyCharged -> SKIP	[] TestEfficiencyPreserved -> TriggerFRule8


MonitoringFRule8 = StartBy(TestEfficiencyPreserved -> SKIP,(24 * 3600))

-- alphabet for FRule8 
AFRule8 = {|FullyCharged, TestEfficiencyPreserved|}
SLEECFRule8 = timed_priority(FRule8)


-- FRule9 when StartMission then FinishMission within 60 seconds
-- otherwise NotifyError within 1 hours 
-- unless (not (authorized))

FRule9 = TriggerFRule9; MonitoringFRule9; FRule9

TriggerFRule9 = StartMission -> SKIP	[] FinishMission -> TriggerFRule9
	[] NotifyError -> TriggerFRule9


MonitoringFRule9 = let
	Monitoring1 = TimedInterruptSeq(FinishMission,(60 * 1),StartBy(NotifyError -> SKIP,(1 * 3600)))
	Monitoring2 = SKIP
within StartBy(authorized?vauthorized ->
	if (not (vauthorized)) then Monitoring2
	else (Monitoring1)
,0)

-- alphabet for FRule9 
AFRule9 = {|NotifyError, authorized, StartMission, FinishMission|}
SLEECFRule9 = timed_priority(FRule9)


-- FRule10 when OperatorInstruction then SoundWarningMessage within 1 seconds 
-- unless ((personNearby) and ((distance) < (1))) then not SprayWater within 1 seconds

FRule10 = TriggerFRule10; MonitoringFRule10; FRule10

TriggerFRule10 = OperatorInstruction -> SKIP	[] SoundWarningMessage -> TriggerFRule10
	[] SprayWater -> TriggerFRule10


MonitoringFRule10 = let
	Monitoring1 = StartBy(SoundWarningMessage -> SKIP,(1 * 1))
	Monitoring2 = WAIT((1 * 1))
within StartBy(personNearby?vpersonNearby ->
	StartBy(distance?vdistance ->
		if ((vpersonNearby) and ((vdistance) < (1))) then Monitoring2
		else (Monitoring1)
	,0)
,0)

-- alphabet for FRule10 
AFRule10 = {|distance, SoundWarningMessage, personNearby, OperatorInstruction, SprayWater|}
SLEECFRule10 = timed_priority(FRule10)


	
}
